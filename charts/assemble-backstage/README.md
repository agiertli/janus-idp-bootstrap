# ⚓️ Assemble Backstage Helm Deploy

The Assemble Backstage Helm Chart customizes and deploys the backstage backend application  written by Red Hat.

## Installing the chart

To install the chart from source:
```bash
# within this directory 
oc new-project assemble
helm upgrade --install assemble-dev . -f values.yaml 
```
To install using oc apply
```bash
# within this directory
helm template assemble-dev . | oc apply -f- 
```

## Configuration

The [values.yml](values.yaml) file contains instructions for common chart overrides.

The operator version can be configuring by modifying the operator configuration values. The startingCSV could be different based on the openshift cluster version.  The channel can be latest, stable or a specific version.

### Postgres Database Configuration

A container version of postgresql will be deployed along with the assamble-backstage application when the external flag is 'false'.  You can
 suppply a database password or a random value can be used and stored in the postgres secret.  

```yaml
postgres:
  external: false
  database_user: postgres
  ## Password will be autogenerated if left empty
  ## If using extrnal instance supply the password
  #database_password: "somepassword"
  port: 5432
  image: registry.redhat.io/rhel9/postgresql-13:1-73
  resources:
    limits:
      cpu: 400m
      memory: 596Mi
    requests:
      cpu: 100m
      memory: 128Mi
```
### Backstage Configuration

There is a secret which containts the backstage app-config.yaml which can be modified using the following sample.   

The 'catalog:' section will define the soures for configuring the catalog section of the app-config.yaml. This content will replace the yaml of that section of the configuraiton.  Refer to [Backstage Catalog Configuration](https://backstage.io/docs/features/software-catalog/configuration) for more details.  

Note: The baseUrl must match the exposed route to ensure communication betweeen the UI and backend services.

```yaml
# backstage configuration
backstage:
  companyname: "My Company"
  baseUrl: 'https://assemble-dev-assemble.apps-crc.testing'

  ## Override Catalog with here
  catalog:
    #import:
    #  entityFilename: /examples/catalog-info.yaml
    #  pullRequestBranchName: backstage-integration
    rules:
      - allow: [Component, System, API, Resource, Location]
    locations:
      # Local example data, file locations are relative to the backend process, typically `packages/backend`
      #- type: file
      #  target: /examples/entities.yaml

      # Local example template
      #- type: file
      #  target: /examples/template/template.yaml
      #  rules:
      #    - allow: [Template]

      # Local example organizational data
      #- type: file
      #  target: /examples/org.yaml
      #  rules:
      #    - allow: [User, Group]
```


## Removing

To delete the chart:
```bash
helm uninstall assemble-dev --namespace assemble
```

To delete when not using helm
```
helm template assemble-dev | oc delete -f-
```

